<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Colloquial Persian</title>
    <style>
        :root {
            --primary: #007AFF;
            --bg: #f2f2f7;
            --card: #ffffff;
            --text: #1c1c1e;
            --subtext: #8e8e93;
            --border: #e5e5ea;
            --success: #34c759;
            --error: #ff3b30;
            --note-bg: #fff8d6;
            --note-border: #f7ce46;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        #app-container {
            width: 100%;
            max-width: 480px; /* Mobile width cap */
            background-color: var(--bg);
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* --- HEADER --- */
        header {
            background-color: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 0 15px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 17px;
            font-weight: 600;
            margin: 0;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 60%;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 16px;
            cursor: pointer;
            padding: 10px 0;
            display: flex;
            align-items: center;
        }
        .nav-btn.hidden { visibility: hidden; }
        .nav-icon { margin-right: 4px; font-size: 20px; line-height: 1; }

        /* --- SCROLL AREA --- */
        #contentArea {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 40px;
        }

        /* --- UNIT LIST --- */
        .unit-card {
            background: var(--card);
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }
        .unit-card:active { background: #e5e5ea; }
        .unit-meta { font-size: 11px; font-weight: 700; color: var(--primary); text-transform: uppercase; margin-bottom: 4px; }
        .unit-title { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
        .unit-desc { font-size: 14px; color: var(--subtext); line-height: 1.4; }

        /* --- LESSON SECTIONS --- */
        .section-header {
            padding: 24px 16px 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--subtext);
            text-transform: uppercase;
        }

        .card {
            background: var(--card);
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 0;
        }

        /* Context Block */
        .context-box {
            padding: 12px 16px;
            font-style: italic;
            color: #666;
            font-size: 13px;
            border-bottom: 1px solid var(--border);
            background-color: #fcfcfc;
        }

        /* Dialogue */
        .dialogue-row {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }
        .dialogue-row:last-child { border-bottom: none; }
        .speaker { font-size: 12px; font-weight: 700; color: var(--primary); margin-bottom: 2px; }
        .farsi { font-size: 19px; font-family: Tahoma, sans-serif; direction: rtl; margin: 4px 0; line-height: 1.4; color: #000; }
        .translit { font-size: 15px; font-weight: 500; color: #333; margin-bottom: 2px; }
        .eng { font-size: 13px; color: var(--subtext); }

        /* Vocabulary */
        .vocab-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }
        .vocab-row:last-child { border-bottom: none; }
        .vocab-left { flex: 1; margin-right: 15px; }
        .vocab-word { font-weight: 600; font-size: 15px; margin-bottom: 2px; }
        .vocab-def { font-size: 13px; color: #666; }
        .vocab-farsi { font-size: 18px; font-family: Tahoma, sans-serif; direction: rtl; white-space: nowrap; }

        /* Teaching / Grammar */
        .teaching-block { padding: 16px; }
        .teaching-text { font-size: 15px; line-height: 1.5; margin-bottom: 12px; color: #333; }
        
        .grammar-point { margin-top: 20px; }
        .grammar-point:first-child { margin-top: 0; }
        .gp-title { font-weight: 700; color: var(--text); margin-bottom: 8px; display: block; }
        
        .example-box {
            background-color: #f9f9f9;
            border-left: 3px solid var(--primary);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 6px 6px 0;
        }
        .example-meta { font-size: 13px; color: #555; margin-top: 4px; }
        
        .note-box {
            margin-top: 15px;
            background-color: var(--note-bg);
            border: 1px solid var(--note-border);
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
            color: #5c4d00;
        }

        /* Grammar Tables */
        table.g-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        table.g-table td, table.g-table th { border: 1px solid var(--border); padding: 8px; text-align: left; }
        table.g-table .farsi { font-size: 16px; direction: rtl; font-family: Tahoma; }

        /* Exercises */
        .exercise-container { padding: 16px; }
        .ex-instruction { font-size: 14px; font-style: italic; color: var(--subtext); margin-bottom: 15px; }
        
        .question-item { margin-bottom: 25px; }
        .q-prompt { font-weight: 500; font-size: 16px; margin-bottom: 8px; display: block; }
        .q-prompt.rtl { direction: rtl; font-family: Tahoma; font-size: 18px; text-align: right; }
        
        .input-wrapper { display: flex; gap: 8px; }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #c7c7cc;
            border-radius: 8px;
            font-size: 16px;
            -webkit-appearance: none;
        }
        input[type="text"].farsi-input {
            direction: rtl;
            font-family: Tahoma;
            text-align: right;
        }
        
        button {
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            padding: 0 16px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-check { background-color: var(--primary); color: white; }
        .btn-check:active { opacity: 0.7; }
        .btn-show { background: transparent; color: var(--primary); padding: 0; margin-left: auto; font-size: 13px; }

        .feedback { margin-top: 8px; font-size: 14px; font-weight: 600; display: flex; align-items: center; min-height: 20px; }
        .feedback.correct { color: var(--success); }
        .feedback.wrong { color: var(--error); }
        .feedback.info { color: var(--subtext); font-weight: 400; direction: ltr; }
        .feedback.info.rtl { direction: rtl; text-align: right; font-family: Tahoma; font-size: 16px; color: #000; }

        /* Matching */
        .matching-row { display: flex; align-items: center; margin-bottom: 10px; justify-content: space-between; border-bottom: 1px solid #f9f9f9; padding-bottom: 8px;}
        .match-select { padding: 8px; border-radius: 6px; border: 1px solid #ccc; background: white; font-size: 14px; width: 45%; }

        /* Radio Options */
        .radio-label {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            background: white;
        }
        .radio-label.selected { border-color: var(--primary); background-color: #f0f7ff; }
        .radio-label input { margin-right: 12px; }

        /* Helpers */
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="app-container">
    <header>
        <button class="nav-btn hidden" id="backBtn" onclick="renderHome()">
            <span class="nav-icon">&#10094;</span> Back
        </button>
        <h1 id="pageTitle">Colloquial Persian</h1>
        <div style="width: 60px;"></div> </header>

    <div id="contentArea"></div>
</div>

<script>
    // ==========================================
    // DATA SECTION
    // ==========================================
    
    // Paste the FULL JSON content inside the brackets below
    const courseData = {
        "course_title": "Colloquial Persian",
        "units": [ 
            {

                
            "unit_id": 1,
            "unit_title": "Greetings (سلام - salām)",
            "description": "Greetings, introductions, thank you, polite forms, simple questions.",
            "content_sequence": [
              {
                "type": "dialogue",
                "id": "u1_d1",
                "title": "Dialogue 1: Greeting and leave-taking",
                "context": "It’s 8 a.m. at the office. Members of staff greet each other briefly.",
                "lines": [
                  { "speaker": "A", "farsi": "سلام. صبح به خیر.", "transliteration": "salām. sob(h) be-xeir.", "english": "Hello. Good morning." },
                  { "speaker": "B", "farsi": "سلام. صبح به خیر.", "transliteration": "salām. sob(h) be-xeir.", "english": "Hello. Good morning." },
                  { "speaker": "A", "farsi": "خدا حافظ. شب به خیر.", "transliteration": "xodā (h)āfez. ŝab be-xeir.", "english": "Goodbye. Goodnight." },
                  { "speaker": "B", "farsi": "خدا حافظ. شب به خیر.", "transliteration": "xodā (h)āfez. ŝab be-xeir.", "english": "Goodbye. Goodnight." }
                ]
              },
              {
                "type": "vocabulary",
                "title": "Vocabulary: Dialogue 1",
                "items": [
                  { "farsi": "سلام", "transliteration": "salām", "english": "hello" },
                  { "farsi": "صبح", "transliteration": "sobh", "english": "morning" },
                  { "farsi": "روز", "transliteration": "ruz", "english": "day" },
                  { "farsi": "به خیر", "transliteration": "be-xeir", "english": "may it be good" },
                  { "farsi": "ظهر", "transliteration": "zohr", "english": "noon" },
                  { "farsi": "خدا", "transliteration": "xodā", "english": "God" },
                  { "farsi": "عصر", "transliteration": "asr", "english": "(late) afternoon" },
                  { "farsi": "حافظ", "transliteration": "hāfez", "english": "protector" },
                  { "farsi": "سفر", "transliteration": "safar", "english": "journey" }
                ]
              },
              {
                "type": "teaching",
                "title": "Language Note: How to say 'Good Morning'",
                "introduction": "The formula is: Time of day + be-xeir (may it be good).",
                "grammar_points": [
                  { "rule": "Morning", "examples": [{ "farsi": "صبح به خیر", "transliteration": "sobh be-xeir", "english": "Good morning" }] },
                  { "rule": "Day", "examples": [{ "farsi": "روز به خیر", "transliteration": "ruz be-xeir", "english": "Good day" }] },
                  { "rule": "Noon", "examples": [{ "farsi": "ظهر به خیر", "transliteration": "zohr be-xeir", "english": "Good mid-day/noon" }] },
                  { "rule": "Afternoon", "examples": [{ "farsi": "عصر به خیر", "transliteration": "asr be-xeir", "english": "Good (late) afternoon" }] },
                  { "rule": "Night", "examples": [{ "farsi": "شب به خیر", "transliteration": "ŝab be-xeir", "english": "Goodnight" }] },
                  { "rule": "Journey", "examples": [{ "farsi": "سفر به خیر", "transliteration": "safar be-xeir", "english": "Have a good journey" }] }
                ],
                "notes": "Note: Younger people are expected to say 'salām' first."
              },
              {
                "type": "exercise",
                "exercise_type": "matching",
                "title": "Exercise 1",
                "instruction": "Match the Farsi word with the English translation.",
                "pairs": [
                  { "id": 1, "prompt": "صبح (sobh)", "match": "morning" },
                  { "id": 2, "prompt": "سلام (salām)", "match": "hello" },
                  { "id": 3, "prompt": "شب (ŝab)", "match": "night" },
                  { "id": 4, "prompt": "خدا حافظ (xodā hāfez)", "match": "goodbye" },
                  { "id": 5, "prompt": "صبح به خیر (sobh be-xeir)", "match": "good morning" },
                  { "id": 6, "prompt": "شب به خیر (ŝab be-xeir)", "match": "goodnight" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 2",
                "instruction": "Can you say these in Persian? (Write in Farsi)",
                "questions": [
                  { "id": 1, "prompt": "Good day", "correct_answer": "روز به خیر" },
                  { "id": 2, "prompt": "Good afternoon", "correct_answer": "عصر به خیر" },
                  { "id": 3, "prompt": "(Have a) good journey", "correct_answer": "سفر به خیر" },
                  { "id": 4, "prompt": "Good mid-day/noon", "correct_answer": "ظهر به خیر" }
                ]
              },
              {
                "type": "dialogue",
                "id": "u1_d2",
                "title": "Dialogue 2: Introducing yourself",
                "context": "Mr Reza Hooshangi (H) has just been called by the information desk officer (O) at the airport in Tehran.",
                "lines": [
                  { "speaker": "H", "farsi": "سلام خانم.", "transliteration": "salām xānom.", "english": "Hello madam." },
                  { "speaker": "O", "farsi": "سلام آقا. بفرمایید.", "transliteration": "salām āqā. befarmāyid.", "english": "Hello sir. Please go ahead." },
                  { "speaker": "H", "farsi": "ببخشید، من هوشنگی هستم. رضا هوشنگی.", "transliteration": "bebaxŝid, man huŝangi hastam. rezā huŝangi.", "english": "Excuse me. I am Hooshangi." },
                  { "speaker": "O", "farsi": "آها بله، این تلفن برای شماست.", "transliteration": "āhā bale, in telefon barāye ŝomāst.", "english": "Ah yes, this telephone is for you." },
                  { "speaker": "H", "farsi": "مرسی خانم. الو؟", "transliteration": "mersi xānom. alou?", "english": "Thanks madam. Hello?" }
                ]
              },
              {
                "type": "vocabulary",
                "title": "Vocabulary: Dialogue 2",
                "items": [
                  { "farsi": "خانم", "transliteration": "xānom", "english": "madam / lady" },
                  { "farsi": "آقا", "transliteration": "āqā", "english": "sir / gentleman" },
                  { "farsi": "بفرمایید", "transliteration": "befarmāyid", "english": "please go ahead" },
                  { "farsi": "ببخشید", "transliteration": "bebaxŝid", "english": "sorry / excuse me" },
                  { "farsi": "من", "transliteration": "man", "english": "I" },
                  { "farsi": "هستم", "transliteration": "hastam", "english": "(I) am" },
                  { "farsi": "بله", "transliteration": "bale", "english": "yes" },
                  { "farsi": "این", "transliteration": "in", "english": "this" },
                  { "farsi": "تلفن", "transliteration": "telefon", "english": "telephone" },
                  { "farsi": "برای", "transliteration": "barāye", "english": "for" },
                  { "farsi": "شما", "transliteration": "ŝomā", "english": "you (formal)" },
                  { "farsi": "مرسی", "transliteration": "mersi", "english": "thanks" },
                  { "farsi": "الو", "transliteration": "alou", "english": "hello" },
                  { "farsi": "بودن", "transliteration": "budan", "english": "to be" },
                  { "farsi": "خوب", "transliteration": "xub", "english": "fine / good" },
                  { "farsi": "هست", "transliteration": "hast", "english": "is (emphatic)" },
                  { "farsi": "دکتر", "transliteration": "doktor", "english": "doctor" },
                  { "farsi": "اما", "transliteration": "ammā", "english": "but" },
                  { "farsi": "ایشون", "transliteration": "iŝun", "english": "s/he (polite)" },
                  { "farsi": "خوش حال", "transliteration": "xoŝ-hāl", "english": "happy" },
                  { "farsi": "پیغام", "transliteration": "peiqām", "english": "message" },
                  { "farsi": "هدیه", "transliteration": "hedye", "english": "present / gift" },
                  { "farsi": "بسته", "transliteration": "baste", "english": "parcel" },
                  { "farsi": "بلیت", "transliteration": "belit", "english": "ticket" },
                  { "farsi": "هم", "transliteration": "ham", "english": "too / also" },
                  { "farsi": "خیلی", "transliteration": "xeili", "english": "very" },
                  { "farsi": "ممنون", "transliteration": "mamnun", "english": "obliged / grateful" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Personal Pronouns & 'To Be'",
                "introduction": "These are the building blocks of Persian sentences.",
                "grammar_points": [
                  {
                    "rule": "Personal Pronouns",
                    "table": [
                      { "farsi": "من", "translit": "man", "eng": "I" },
                      { "farsi": "تو", "translit": "to", "eng": "you (informal)" },
                      { "farsi": "او", "translit": "u", "eng": "he/she" },
                      { "farsi": "آن", "translit": "ān", "eng": "it/that" },
                      { "farsi": "این", "translit": "in", "eng": "this" },
                      { "farsi": "ما", "translit": "mā", "eng": "we" },
                      { "farsi": "شما", "translit": "ŝomā", "eng": "you (formal)" },
                      { "farsi": "آنها", "translit": "ānhā", "eng": "they" }
                    ]
                  },
                  {
                    "rule": "The Verb 'To Be'",
                    "examples": [
                      { "farsi": "من خوب هستم", "transliteration": "man xub hastam", "english": "I am fine" },
                      { "farsi": "تو خوب هستی", "transliteration": "to xub hasti", "english": "You are fine" },
                      { "farsi": "آنها خوب هستند", "transliteration": "ānhā xub hastand", "english": "They are fine" }
                    ]
                  }
                ],
                "notes": "The verb normally comes at the end of the sentence. The word 'ast' is the normal equivalent for English 'is'. When 'is' carries stress (emphasis), the Persian equivalent is 'hast'. In colloquial Persian, 'ān' is often pronounced 'un', and 'ānhā' as 'unhā'."
              },
              {
                "type": "teaching",
                "title": "Language Note: Polite Forms & Questions",
                "grammar_points": [
                  { 
                      "rule": "Polite Forms", 
                      "content": "For 'you', 'shomā' is formal. For 'he/she', 'u' is neutral, but 'ishun' is polite and takes a plural verb.",
                      "examples": [
                          { "farsi": "ایشون خانم جانسون هستند", "transliteration": "iŝun xānom-e jānson hastand", "english": "She is Ms Johnson" }
                      ] 
                  },
                  { 
                      "rule": "Questions", 
                      "content": "To ask a yes/no question, simply raise your intonation. The word order does not change.",
                      "examples": [
                          { "type": "Statement", "farsi": "شما دکتر هستید.", "transliteration": "ŝomā doktor hastid.", "english": "You are a doctor." },
                          { "type": "Question", "farsi": "شما دکتر هستید؟", "transliteration": "ŝomā doktor hastid?", "english": "Are you a doctor?" }
                      ] 
                  }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "substitution",
                "title": "Exercise 3",
                "input_mode": "farsi",
                "instruction": "Replace the word 'khub' (fine) with 'khosh-hāl' (happy) to produce the Persian equivalents. Write in Persian.",
                "questions": [
                  { "prompt": "I am happy", "correct_answer": "من خوش حال هستم" },
                  { "prompt": "You (inf) are happy", "correct_answer": "تو خوش حال هستی" },
                  { "prompt": "He/She is happy", "correct_answer": "او خوش حال است" },
                  { "prompt": "It/That is happy", "correct_answer": "آن خوش حال است" },
                  { "prompt": "We are happy", "correct_answer": "ما خوش حال هستیم" },
                  { "prompt": "You (formal) are happy", "correct_answer": "شما خوش حال هستید" },
                  { "prompt": "They are happy", "correct_answer": "آنها خوش حال هستند" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 4",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "id": 1, "prompt": "Hello sir. I am Peter Brown.", "correct_answer": "سلام آقا. من پیتر براون هستم" },
                  { "id": 2, "prompt": "Oh yes, this message is for you.", "correct_answer": "آها بله، این پیغام برای شماست" },
                  { "id": 3, "prompt": "This present is for you.", "correct_answer": "این هدیه برای شماست" },
                  { "id": 4, "prompt": "This present is for Mr Ahmadi.", "correct_answer": "این هدیه برای آقای احمدی است" },
                  { "id": 5, "prompt": "This parcel is for Ms Ahmadi.", "correct_answer": "این بسته برای خانم احمدی است" },
                  { "id": 6, "prompt": "This is Ms Ahmadi (introducing).", "correct_answer": "ایشون خانم احمدی هستند" },
                  { "id": 7, "prompt": "This is Mr Kamran (introducing).", "correct_answer": "ایشون آقای کامران هستند" },
                  { "id": 8, "prompt": "Are you Ms Johnson?", "correct_answer": "شما خانم جانسون هستید؟" }
                ]
              },
              {
                "type": "comprehension",
                "title": "Comprehension",
                "context": "A has just called into a travel agency.",
                "dialogue": [
                    { "speaker": "A", "farsi": "سلام آقا.", "transliteration": "salām āqā.", "english": "Hello sir." },
                    { "speaker": "B", "farsi": "سلام خانم. عصر به خیر.", "transliteration": "salām xānom. asr be-xeir.", "english": "Hello madam. Good afternoon." },
                    { "speaker": "A", "farsi": "عصر به خیر. ببخشید، شما آقای کامران هستید؟", "transliteration": "asr be-xeir. bebaxŝid, ŝomā āqāye kāmrān hastid?", "english": "Good afternoon. Excuse me, are you Mr Kamran?" },
                    { "speaker": "B", "farsi": "بله، بفرمایید.", "transliteration": "bale, befarmāyid.", "english": "Yes, please go ahead." },
                    { "speaker": "A", "farsi": "من احمدی هستم.", "transliteration": "man ahmadi hastam.", "english": "I am Ahmadi." },
                    { "speaker": "B", "farsi": "آها بله، خانم احمدی. این بلیت برای شماست. این پیغام هم برای شماست.", "transliteration": "āhā bale, xānom-e ahmadi. in belit barāye ŝomāst. in peiqām ham barāye ŝomāst.", "english": "Ah yes, Ms Ahmadi. This ticket is for you. This message is also for you." },
                    { "speaker": "A", "farsi": "خیلی ممنون. خدا حافظ.", "transliteration": "xeili mamnun. xodā hāfez.", "english": "Many thanks. Goodbye." },
                    { "speaker": "B", "farsi": "خدا حافظ.", "transliteration": "xodā hāfez.", "english": "Goodbye." }
                ],
                "questions": [
                  { "question": "What time of the day is it?", "options": ["Morning", "Late afternoon", "Night"], "correct_index": 1 },
                  { "question": "What does A want to know?", "options": ["If B is Mr Kamran", "If the ticket is ready"], "correct_index": 0 },
                  { "question": "Who is A?", "options": ["Mr Kamran", "Ms Ahmadi", "Ms Johnson"], "correct_index": 1 },
                  { "question": "What two things is B offering A?", "options": ["A ticket and a message", "A parcel"], "correct_index": 0 },
                  { "question": "What is B wishing?", "options": ["Goodnight", "Good luck", "A good journey"], "correct_index": 2 }
                ]
              }
            ]
          },
          {
            "unit_id": 2,
            "unit_title": "Enquiring about health",
            "description": "How to say 'How are you?', introductions, possession.",
            "content_sequence": [
              {
                "type": "dialogue",
                "id": "u2_d1",
                "title": "Dialogue 1: How're you?",
                "context": "Bahman (B) is ringing his close friend Ali (A).",
                "lines": [
                  { "speaker": "A", "farsi": "الو؟", "transliteration": "alou?", "english": "Hello?" },
                  { "speaker": "B", "farsi": "علی جان، سلام.", "transliteration": "ali jān, salām.", "english": "Dear Ali, hello." },
                  { "speaker": "A", "farsi": "سلام، چطوری؟", "transliteration": "salām, ceto(u)ri?", "english": "Hello, how're you?" },
                  { "speaker": "B", "farsi": "خوبم، مرسی. تو چطوری؟", "transliteration": "xubam, mersi. to ceto(u)ri?", "english": "I'm fine, thank you. How're you?" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Contraction of 'To Be'",
                "introduction": "In spoken Farsi, the verb 'to be' is often contracted and attached to the preceding word.",
                "grammar_points": [
                  { 
                    "rule": "Positive Forms", 
                    "examples": [
                      { "farsi": "من خوبم", "transliteration": "man xubam", "english": "I'm fine" },
                      { "farsi": "تو خوبی", "transliteration": "to xubi", "english": "You're fine" },
                      { "farsi": "او خوبه", "transliteration": "u xube", "english": "He/She's fine" },
                      { "farsi": "آن خوبه", "transliteration": "ān (un) xube", "english": "It/That's fine" },
                      { "farsi": "ما خوبیم", "transliteration": "mā xubim", "english": "We're fine" },
                      { "farsi": "شما خوبید", "transliteration": "ŝomā xubid", "english": "You're fine" },
                      { "farsi": "آنها خوبند", "transliteration": "ānhā xuband", "english": "They're fine" }
                    ]
                  }
                ],
                "notes": "What comes after the word 'xub' (fine) in the examples above are the reduced forms of the verb 'budan' (to be). They also act as personal endings for other verbs. Since these endings indicate 'person', the personal pronouns are often omitted as redundant. Note: In casual speech, the second-and third-person plural endings '-id' and '-and' are slightly modified as '-in' and '-an', respectively (e.g. shomā xubin)."
              },
              {
                "type": "exercise",
                "exercise_type": "substitution",
                "title": "Exercise 1",
                "input_mode": "farsi",
                "instruction": "Replace the word 'xub' (fine) with 'xoŝ-hāl' (happy). Write in Persian.",
                "questions": [
                  { "prompt": "I'm happy", "correct_answer": "من خوش حالم" },
                  { "prompt": "You (inf) are happy", "correct_answer": "تو خوش حالی" },
                  { "prompt": "He/she is happy", "correct_answer": "او خوش حاله" },
                  { "prompt": "We are happy", "correct_answer": "ما خوش حالیم" },
                  { "prompt": "You (pl) are happy", "correct_answer": "شما خوش حالید" },
                  { "prompt": "They are happy", "correct_answer": "آنها خوش حالند" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Reduced forms after vowels & Negatives",
                "introduction": "Adjustments are made if the word ends in a vowel. Also, negatives do NOT reduce.",
                "grammar_points": [
                  { "rule": "After 'a'", "examples": [{ "transliteration": "man injām", "english": "I'm here" }] },
                  { "rule": "After 'e'", "examples": [{ "transliteration": "man gorosn(e)am", "english": "I'm hungry" }] },
                  { "rule": "Negative (No reduction)", "examples": [{ "farsi": "من نیستم", "transliteration": "man nistam", "english": "I am not" }] }
                ],
                "notes": "For the third person singular ('s/he, it') the original 'ast' is used with a slight modification. For instance, 'inja ast' becomes 'injast' (He is here) and 'gorosne ast' becomes 'gorosn(e)ast' (He is hungry). Notice the pronunciation of the last example: the vowel 'e' is almost dropped. \n\nNote: Unlike English, the Persian verb 'budan' (to be) has no reduced negative forms. Therefore, 'mā ... nistim' would be an equivalent to these English sentences: We are not ...; We aren't...; We're not ..."
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 2",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "prompt": "I am not hungry", "correct_answer": "من گرسنه نیستم" },
                  { "prompt": "We are not hungry", "correct_answer": "ما گرسنه نیستیم" },
                  { "prompt": "You (inf) are not hungry", "correct_answer": "تو گرسنه نیستی" },
                  { "prompt": "They are not hungry", "correct_answer": "آنها گرسنه نیستند" },
                  { "prompt": "You (pl) are not hungry", "correct_answer": "شما گرسنه نیستید" },
                  { "prompt": "He/she is not hungry", "correct_answer": "او گرسنه نیست" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Questions",
                "content": "Questions beginning with question words have a falling tone.",
                "grammar_points": [
                  { "rule": "Question Words", "examples": [
                      { "transliteration": "ce / ci", "english": "what" },
                      { "transliteration": "ki", "english": "who" },
                      { "transliteration": "cerā", "english": "why" },
                      { "transliteration": "kei", "english": "when" },
                      { "transliteration": "kodum", "english": "which" },
                      { "transliteration": "ceto(u)r", "english": "how" },
                      { "transliteration": "kojā", "english": "where" },
                      { "transliteration": "cand", "english": "how many" },
                      { "transliteration": "cegune", "english": "how (more literary)" },
                      { "transliteration": "ku", "english": "where is it? (col)" },
                      { "transliteration": "cand tā", "english": "how many (col)" },
                      { "transliteration": "ceqadr", "english": "how much" },
                      { "transliteration": "cand vaqt", "english": "how long" }
                  ]}
                ],
                "notes": "The above question words normally carry the sentence stress. After 'cand' or 'cand tā' (how many), the noun takes a singular form."
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 3",
                "instruction": "Can you say these in Persian?",
                "questions": [
                  { "id": 1, "prompt": "How're you? (inf)", "correct_answer": "چطوری" },
                  { "id": 2, "prompt": "How're you? (f)", "correct_answer": "چطورید" },
                  { "id": 3, "prompt": "How's Mum/Dad?", "correct_answer": "مامان/بابا چطورند" },
                  { "id": 4, "prompt": "How're the family?", "correct_answer": "خانواده چطورند" },
                  { "id": 5, "prompt": "How's Parviz?", "correct_answer": "پرویز چطوره" },
                  { "id": 6, "prompt": "Are you OK?", "correct_answer": "خوبید" },
                  { "id": 7, "prompt": "Are you tired?", "correct_answer": "خسته اید" }
                ]
              },
              {
                "type": "dialogue",
                "id": "u2_d2",
                "title": "Dialogue 2: Pleased to meet you!",
                "lines": [
                  { "speaker": "A", "farsi": "سلام. من احمدی هستم. اسم شما چیه؟", "transliteration": "salām. man ahmadi hastam. esm-e ŝomā cie?", "english": "Hello. I am Ahmadi. What's your name?" },
                  { "speaker": "B", "farsi": "سلام. من بهزادی هستم.", "transliteration": "salām. man behzādi hastam.", "english": "Hello. I am Behzadi." }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Ezāfe & Possession",
                "introduction": "Ezāfe (-e) links nouns.",
                "grammar_points": [
                  { "rule": "Possession", "examples": [{ "farsi": "تلفنِ جک", "transliteration": "telefon-e jak", "english": "Jack's telephone" }] },
                  { "rule": "Adjective", "examples": [{ "farsi": "فیلم بد", "transliteration": "film-e bad", "english": "Bad film" }] }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 4",
                "instruction": "Translate using Ezāfe in Persian.",
                "questions": [
                  { "prompt": "My car", "correct_answer": "ماشین من" },
                  { "prompt": "My telephone", "correct_answer": "تلفن من" },
                  { "prompt": "His/her name", "correct_answer": "اسم او" },
                  { "prompt": "Our flat", "correct_answer": "آپارتمان ما" },
                  { "prompt": "Their computer", "correct_answer": "کامپیوتر آنها" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 6",
                "instruction": "Repeat Exercise 4 using possessive endings (e.g. My car -> mashinam). Write in Persian.",
                "questions": [
                  { "prompt": "My car", "correct_answer": "ماشینم" },
                  { "prompt": "My telephone", "correct_answer": "تلفنم" },
                  { "prompt": "His/her name", "correct_answer": "اسمش" },
                  { "prompt": "Our flat", "correct_answer": "آپارتمانمون" },
                  { "prompt": "Their computer", "correct_answer": "کامپیوترشون" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "title": "Exercise 7",
                "input_mode": "farsi",
                "instruction": "Respond to 'I am hungry' etc. with 'So am I' / 'So do I'. Write in Persian.",
                "questions": [
                  { "prompt": "So am I", "correct_answer": "من هم همین طور" },
                  { "prompt": "So are we", "correct_answer": "ما هم همین طور" },
                  { "prompt": "So is Peter", "correct_answer": "پیتر هم همین طور" },
                  { "prompt": "So do I", "correct_answer": "من هم همین طور" },
                  { "prompt": "So does s/he", "correct_answer": "او هم همین طور" },
                  { "prompt": "So have I", "correct_answer": "من هم همین طور" },
                  { "prompt": "Nor did we", "correct_answer": "ما هم همین طور" },
                  { "prompt": "Nor will I", "correct_answer": "من هم همین طور" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "fill_in_blank",
                "input_mode": "farsi",
                "title": "Exercise 8",
                "instruction": "Complete these questions (e.g. 'What is your name?'). Write in Persian.",
                "questions": [
                  { "prompt": "What's your name? (f)", "correct_answer": "اسمتون چیه؟" },
                  { "prompt": "What's his/her address?", "correct_answer": "آدرسش چیه؟" },
                  { "prompt": "What's their nationality?", "correct_answer": "ملیتشون چیه؟" },
                  { "prompt": "What's your date of birth? (f)", "correct_answer": "تاریخ تولدتون چیه؟" },
                  { "prompt": "What's your phone number? (inf)", "correct_answer": "شماره تلفنت چنده؟" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 9",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "prompt": "How's your mother? She's fine, thanks.", "correct_answer": "مادرتون چطورند؟ خوبند مرسی." },
                  { "prompt": "What's your job? I'm a doctor.", "correct_answer": "کارتون چیه؟ دکتر هستم." },
                  { "prompt": "Your flat is pretty. Thank you.", "correct_answer": "آپارتمانتون قشنگه. ممنون." },
                  { "prompt": "Who's this? That's my brother.", "correct_answer": "این کیه؟ اون برادرمه." },
                  { "prompt": "What's that? It's my lunch.", "correct_answer": "اون چیه؟ اون ناهارمه." },
                  { "prompt": "Where's your car? It's here. Where's yours?", "correct_answer": "ماشینتون کجاست؟ اینجاست. مال شما کجاست؟" },
                  { "prompt": "Whose car is this? It's mine.", "correct_answer": "این ماشین مال کیه؟ مال منه." }
                ]
              },
              {
                "type": "comprehension",
                "title": "Comprehension Quiz",
                "questions": [
                  { "question": "Where is Ahmad calling from?", "options": ["Tehran", "London"], "correct_index": 1 },
                  { "question": "Who is he with?", "options": ["Alone", "With family"], "correct_index": 1 }
                ]
              }
            ]
          },
          {
            "unit_id": 3,
            "unit_title": "Where are you from? (کجایی هستید؟)",
            "description": "Seek and give personal details: gender, nationality, marital status, place of birth, hobbies, occupation.",
            "content_sequence": [
              {
                "type": "dialogue",
                "id": "u3_d1",
                "title": "Dialogue 1: Party game: Who am I?",
                "context": "At an Iranian party in London. Guests try to identify a well-known figure.",
                "lines": [
                  { "speaker": "A", "farsi": "شما زن هستید؟", "transliteration": "ŝomā zan hastid?", "english": "Are you a woman?" },
                  { "speaker": "B", "farsi": "نه.", "transliteration": "na.", "english": "No." },
                  { "speaker": "A", "farsi": "ملیتتون چیه؟", "transliteration": "melliyatetun cie?", "english": "What's your nationality?" },
                  { "speaker": "B", "farsi": "بریتانیایی هستم.", "transliteration": "beritāniāyi hastam.", "english": "I'm British." },
                  { "speaker": "A", "farsi": "شما متأهليد؟", "transliteration": "ŝomā mota ahhelid?", "english": "Are you married?" },
                  { "speaker": "B", "farsi": "بله.", "transliteration": "bale.", "english": "Yes." },
                  { "speaker": "A", "farsi": "خانمتون کجایی هستند؟", "transliteration": "xānometun kojāyi hastand?", "english": "Where does your wife come from?" },
                  { "speaker": "B", "farsi": "اون هم بریتانیاییه.", "transliteration": "un (h)am beritāniāyie.", "english": "She too is British." },
                  { "speaker": "A", "farsi": "محل تولدتون کجاست؟", "transliteration": "mahall-e tavallodetun kojāst?", "english": "Where's your place of birth?" },
                  { "speaker": "B", "farsi": "لندن.", "transliteration": "landan.", "english": "London." },
                  { "speaker": "A", "farsi": "سرگرمی هاتون چیه؟", "transliteration": "sargarmihātun cie?", "english": "What are your hobbies?" },
                  { "speaker": "B", "farsi": "موسیقی، ورزش، مطالعه.", "transliteration": "musiqi, varzeŝ, motāle`e.", "english": "Music, sport, reading." },
                  { "speaker": "A", "farsi": "کارتون چیه؟", "transliteration": "kāretun cie?", "english": "What's your job?" },
                  { "speaker": "B", "farsi": "کارمند هستم.", "transliteration": "kārmand hastam.", "english": "I'm a (civil) servant." },
                  { "speaker": "A", "farsi": "محل کارتون کجاست؟", "transliteration": "mahall-e kāretun kojāst?", "english": "Where's your place of work?" },
                  { "speaker": "B", "farsi": "لندن، خیابان داونینگ، پلاک ۱۰.", "transliteration": "landan, xiābān-e dāwning, pelāk-e dah.", "english": "London, Downing Street, No. 10." },
                  { "speaker": "A", "farsi": "شما نخست وزیر هستید؟", "transliteration": "ŝomā noxost-vazir hastid?", "english": "Are you the Prime Minister?" },
                  { "speaker": "B", "farsi": "بله، متشکرم.", "transliteration": "bale, mot(a)ŝakkeram.", "english": "Yes, thank you." }
                ]
              },
              {
                "type": "vocabulary",
                "title": "Vocabulary: Dialogue 1",
                "items": [
                  { "farsi": "زن", "transliteration": "zan", "english": "woman" },
                  { "farsi": "نه", "transliteration": "na", "english": "no" },
                  { "farsi": "ملیت", "transliteration": "melliyat", "english": "nationality" },
                  { "farsi": "چی", "transliteration": "ci", "english": "what" },
                  { "farsi": "چیه", "transliteration": "cie", "english": "what's (what is)" },
                  { "farsi": "بریتانیایی", "transliteration": "beritāniāyi", "english": "British" },
                  { "farsi": "متأهل", "transliteration": "mota-ahhel", "english": "married" },
                  { "farsi": "بله", "transliteration": "bale", "english": "yes" },
                  { "farsi": "خانم", "transliteration": "xānom", "english": "wife, madam" },
                  { "farsi": "کجا", "transliteration": "kojā", "english": "where" },
                  { "farsi": "کجایی", "transliteration": "kojāyi", "english": "where from" },
                  { "farsi": "هم", "transliteration": "ham", "english": "too, also" },
                  { "farsi": "محل", "transliteration": "mahall", "english": "place" },
                  { "farsi": "تولد", "transliteration": "tavallod", "english": "birth" },
                  { "farsi": "کجاست", "transliteration": "kojāst", "english": "where's" },
                  { "farsi": "لندن", "transliteration": "landan", "english": "London" },
                  { "farsi": "سرگرمی", "transliteration": "sargarmi", "english": "hobby" },
                  { "farsi": "سرگرمی ها", "transliteration": "sargarmihā", "english": "hobbies" },
                  { "farsi": "موسیقی", "transliteration": "musiqi", "english": "music" },
                  { "farsi": "ورزش", "transliteration": "varzeŝ", "english": "sport" },
                  { "farsi": "مطالعه", "transliteration": "motāle'e", "english": "reading" },
                  { "farsi": "کار", "transliteration": "kār", "english": "job, work" },
                  { "farsi": "کارمند", "transliteration": "kārmand", "english": "(civil) servant" },
                  { "farsi": "خیابان", "transliteration": "xiābān", "english": "street" },
                  { "farsi": "خیابان داونینگ", "transliteration": "xiābān-e dāwning", "english": "Downing Street" },
                  { "farsi": "پلاک", "transliteration": "pelāk", "english": "(house) number" },
                  { "farsi": "نخست وزیر", "transliteration": "noxost-vazir", "english": "Prime Minister" },
                  { "farsi": "متشکر", "transliteration": "motaŝakker", "english": "thankful, grateful" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: How to describe nationality",
                "introduction": "The basic formula is: Place name + i (suffix).",
                "grammar_points": [
                  { "rule": "Place name + i", "examples": [
                      { "transliteration": "irān -> irāni", "english": "Iranian" },
                      { "transliteration": "engelis -> engelisi", "english": "English" },
                      { "transliteration": "eskatland -> eskatlandi", "english": "Scottish" },
                      { "transliteration": "pākestān -> pākestāni", "english": "Pakistani" },
                      { "transliteration": "zhāpon -> zhāponi", "english": "Japanese" }
                  ]},
                  { "rule": "Place name (ending in vowel) + yi", "examples": [
                      { "transliteration": "beritāniā -> beritāniāyi", "english": "British" },
                      { "transliteration": "āmrikā -> āmrikāyi", "english": "American" },
                      { "transliteration": "kānādā -> kānādāyi", "english": "Canadian" },
                      { "transliteration": "osterāliā -> osterāliāyi", "english": "Australian" }
                  ]}
                ],
                "notes": "If a place name already ends in 'i', various forms may be used (e.g. libi -> libiāyi 'Libyan'). Word stress is shifted over to the suffix."
              },
              {
                "type": "exercise",
                "exercise_type": "matching",
                "title": "Exercise 1",
                "instruction": "Match the place with the nationality.",
                "pairs": [
                  { "id": 1, "prompt": "تهران", "match": "تهرانی" },
                  { "id": 2, "prompt": "لندن", "match": "لندنی" },
                  { "id": 3, "prompt": "پاریس", "match": "پاریسی" },
                  { "id": 4, "prompt": "مشهد", "match": "مشهدی" },
                  { "id": 5, "prompt": "اصفهان", "match": "اصفهانی" },
                  { "id": 6, "prompt": "ایتالیا", "match": "ایتالیایی" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 2",
                "instruction": "You have met a Persian speaker. Ask them questions in Persian.",
                "questions": [
                  { "prompt": "Ask if he/she is Iranian.", "correct_answer": "شما ایرانی هستید؟" },
                  { "prompt": "Ask if he/she is married.", "correct_answer": "شما متاهلید؟" },
                  { "prompt": "Ask where he/she was born.", "correct_answer": "محل تولدتون کجاست؟" },
                  { "prompt": "Ask where he/she works.", "correct_answer": "محل کارتون کجاست؟" },
                  { "prompt": "Ask where his wife/her husband comes from.", "correct_answer": "همسرتون کجایی هستند؟" },
                  { "prompt": "Ask what his/her hobbies are.", "correct_answer": "سرگرمی هاتون چیه؟" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Plural of Nouns",
                "content": "The most common way to make a noun plural is by adding the suffix -hā.",
                "grammar_points": [
                  { "rule": "Suffix -hā (General)", "examples": [
                      { "transliteration": "telefon -> telefonhā", "english": "telephones" },
                      { "transliteration": "sargarmi -> sargarmihā", "english": "hobbies" }
                  ]},
                  { "rule": "Inanimate Nouns", "content": "With inanimate nouns, the verb can take a singular form.", "examples": [
                      { "farsi": "کامپیوترها خرابند", "transliteration": "kāmpiuterhā xarāband", "english": "The computers are broken (plural verb)" },
                      { "farsi": "کامپیوترها خرابه", "transliteration": "kāmpiuterhā xarābe", "english": "The computers are broken (singular verb)" }
                  ]},
                  { "rule": "Suffix -ān (Animate/Formal)", "content": "For animate nouns (people), the suffix -ān is often used in formal contexts.", "examples": [
                      { "transliteration": "mard -> mardān", "english": "men" },
                      { "transliteration": "dust -> dustān", "english": "friends" },
                      { "transliteration": "āqā -> āqāyān", "english": "gentlemen" },
                      { "transliteration": "dāneŝju -> dāneŝjuyān", "english": "students" }
                  ]}
                ],
                "notes": "The 'h' of the plural marker -hā is often dropped in speech. Adjectives can also be pluralised (e.g. xubān - the good/good people). The plural endings carry the word stress."
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 3",
                "instruction": "Write the plural of these nouns in Persian script.",
                "questions": [
                  { "prompt": "آپارتمان (flat)", "correct_answer": "آپارتمان ها" },
                  { "prompt": "ماشین (car)", "correct_answer": "ماشین ها" },
                  { "prompt": "روزنامه (newspaper)", "correct_answer": "روزنامه ها" },
                  { "prompt": "ایرانی (Iranian)", "correct_answer": "ایرانی ها" },
                  { "prompt": "دوست (friend)", "correct_answer": "دوستان" },
                  { "prompt": "خوش رو (friendly person)", "correct_answer": "خوش رویان" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 4",
                "instruction": "Can you say these in Persian?",
                "questions": [
                  { "prompt": "Where are you from?", "correct_answer": "کجایی هستید؟" },
                  { "prompt": "I'm from London.", "correct_answer": "لندنی هستم" },
                  { "prompt": "I'm Italian.", "correct_answer": "ایتالیایی هستم" },
                  { "prompt": "My place of birth is London.", "correct_answer": "محل تولدم لندن است" },
                  { "prompt": "My hobbies are music and reading.", "correct_answer": "سرگرمی هام موسیقی و مطالعه است" },
                  { "prompt": "My watch is made in Japan.", "correct_answer": "ساعتم ساخت ژاپن است" }
                ]
              },
              {
                "type": "dialogue",
                "id": "u3_d2",
                "title": "Dialogue 2: Introducing B to C",
                "context": "Mr Ahmadi (A) introduces his colleague Mr Morris (B) to his wife Shahin (C).",
                "lines": [
                  { "speaker": "A", "farsi": "آقای موریس همکارم هستند و ایشون خانمم هستند.", "transliteration": "āqā-ye moris hamkāram (hastand), va iŝun xānomam hastand.", "english": "Mr Morris is my colleague, and this is my wife." },
                  { "speaker": "C", "farsi": "خوشوقتم.", "transliteration": "xoŝvaqtam.", "english": "I'm pleased (to meet you)." },
                  { "speaker": "B", "farsi": "من هم همین طور. آپارتمان قشنگی دارید.", "transliteration": "man (h)am hamin-to(u)r. āpārtemān-e qaŝangi dārid.", "english": "So am I. You have a nice flat." },
                  { "speaker": "C", "farsi": "متشکرم. لطف دارید.", "transliteration": "mot(a)ŝakkeram. lotf dārid.", "english": "Thank you. That's very kind of you." }
                ]
              },
              {
                "type": "vocabulary",
                "title": "Vocabulary: Dialogue 2",
                "items": [
                  { "farsi": "آقای", "transliteration": "āqā-ye", "english": "Mr" },
                  { "farsi": "همکار", "transliteration": "hamkār", "english": "colleague" },
                  { "farsi": "ایشون", "transliteration": "iŝun", "english": "he, she (pol)" },
                  { "farsi": "خانم", "transliteration": "xānom", "english": "wife" },
                  { "farsi": "خوشوقت", "transliteration": "xoŝvaqt", "english": "pleased" },
                  { "farsi": "آپارتمان", "transliteration": "āpārtemān", "english": "apartment" },
                  { "farsi": "قشنگ", "transliteration": "qaŝang", "english": "nice, pretty" },
                  { "farsi": "دارید", "transliteration": "dārid", "english": "you have" },
                  { "farsi": "داشتن", "transliteration": "dāŝtan", "english": "to have" },
                  { "farsi": "متشکر", "transliteration": "mot(a)ŝakker", "english": "grateful" },
                  { "farsi": "لطف", "transliteration": "lotf", "english": "kindness" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: The Verb 'To Have' (Dāshtan)",
                "content": "All Persian verbs end with '-an'. Present stem of 'dashtan' is 'dār'.",
                "grammar_points": [
                  { "rule": "Positive Conjugation", "examples": [
                      { "farsi": "من دارم", "transliteration": "man dāram", "english": "I have" },
                      { "farsi": "تو داری", "transliteration": "to dāri", "english": "You have" },
                      { "farsi": "او دارد / داره", "transliteration": "u dārad / dāre", "english": "He/She has" },
                      { "farsi": "ما داریم", "transliteration": "mā dārim", "english": "We have" },
                      { "farsi": "شما دارید", "transliteration": "ŝomā dārid", "english": "You have" },
                      { "farsi": "آنها دارند", "transliteration": "ānhā dārand", "english": "They have" }
                  ]},
                  { "rule": "Negative Conjugation", "content": "Add na- to the beginning (stress on na).", "examples": [
                      { "farsi": "من ندارم", "transliteration": "man nadāram", "english": "I don't have" }
                  ]}
                ],
                "notes": "We don't need the Persian equivalent of 'a' (indefinite article) for this pattern (e.g. 'man mashin daram' = I have a car). The verb 'to have' is also used to talk about age: 'man 20 sal daram' (I am 20 years old)."
              },
              {
                "type": "exercise",
                "exercise_type": "matching",
                "title": "Exercise 5",
                "instruction": "Match the pronoun with the verb ending for 'to have'.",
                "pairs": [
                  { "id": 1, "prompt": "من", "match": "دارم" },
                  { "id": 2, "prompt": "تو", "match": "داری" },
                  { "id": 3, "prompt": "او", "match": "داره" },
                  { "id": 4, "prompt": "ما", "match": "داریم" },
                  { "id": 5, "prompt": "شما", "match": "دارید" },
                  { "id": 6, "prompt": "آنها", "match": "دارند" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 6",
                "instruction": "Make these sentences negative in Persian.",
                "questions": [
                  { "prompt": "من تلفن دارم", "correct_answer": "من تلفن ندارم" },
                  { "prompt": "تو بلیت داری", "correct_answer": "تو بلیت نداری" },
                  { "prompt": "او ۲۵ سال داره", "correct_answer": "او ۲۵ سال نداره" },
                  { "prompt": "ما اتاق خالی داریم", "correct_answer": "ما اتاق خالی نداریم" },
                  { "prompt": "شما وقت دارید", "correct_answer": "شما وقت ندارید" },
                  { "prompt": "آنها پول دارند", "correct_answer": "آنها پول ندارند" }
                ]
              },
              {
                "type": "teaching",
                "title": "Cardinal Numbers (1-1000+)",
                "content": "From 21 onwards we add 'o' (and) between numbers.",
                "grammar_points": [
                  { "rule": "1-10", "examples": [{ "transliteration": "yek, do, se, cahār, panj, ŝeŝ, haft, haŝt, noh, dah", "english": "1, 2, 3, 4, 5, 6, 7, 8, 9, 10" }] },
                  { "rule": "11-20", "examples": [{ "transliteration": "yāzdah, davāzdah, sizdah, cahārdah, pānzdah, ŝānzdah, hefdah, hejdah, nuzdah, bist", "english": "11-20" }] },
                  { "rule": "Tens", "examples": [{ "transliteration": "bist, si, cehel, panjāh, ŝast, haftād, haŝtād, navad, sad", "english": "20, 30, 40, 50, 60, 70, 80, 90, 100" }] },
                  { "rule": "Hundreds", "examples": [{ "transliteration": "devist, sisad, cahārsad, pānsad, ŝeŝsad, haftsad, haŝtsad, nohsad, hezār", "english": "200, 300 ... 1000" }] },
                  { "rule": "Millions", "examples": [{ "transliteration": "yek milyun", "english": "1,000,000" }] }
                ],
                "notes": "After a number or 'cand tā' (how many), the noun comes in the singular (e.g. panj mashin = five cars)."
              },
              {
                "type": "teaching",
                "title": "Indefinite & Definite Articles",
                "content": "Persian often doesn't distinguish 'a' and 'the' (masin xarabe = The car is broken). To mark indefinite, we use 'yek' (one) or suffix '-i'.",
                "grammar_points": [
                  { "rule": "Indefinite", "examples": [
                      { "farsi": "یک آپارتمان", "transliteration": "yek āpārtemān", "english": "A flat" },
                      { "farsi": "آپارتمانی", "transliteration": "āpārtemāni", "english": "A flat" }
                  ]}
                ],
                "notes": "When the noun is qualified by an adjective, the ending goes after the adjective: aparteman-e qasangi (a nice flat)."
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 7",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "prompt": "You have a nice car!", "correct_answer": "ماشین قشنگی دارید" },
                  { "prompt": "That's very kind of you.", "correct_answer": "لطف دارید" },
                  { "prompt": "I'm sorry, I don't have time.", "correct_answer": "ببخشید، وقت ندارم" },
                  { "prompt": "He's 30 years old.", "correct_answer": "سی سال داره" },
                  { "prompt": "This is my friend Peter.", "correct_answer": "این دوستم پیتره" },
                  { "prompt": "Pleased to meet you. So am I.", "correct_answer": "خوشوقتم. من هم همین طور" },
                  { "prompt": "I have five Iranian friends.", "correct_answer": "من پنج دوست ایرانی دارم" }
                ]
              },
              {
                "type": "comprehension",
                "title": "Comprehension Quiz",
                "context": "Parviz Alizadeh's recorded message.",
                "questions": [
                  { "question": "What is his full name?", "options": ["Parviz Ahmadi", "Parviz Alizadeh", "Ali Alizadeh"], "correct_index": 1 },
                  { "question": "What is his job?", "options": ["Teacher", "Civil Servant", "Engineer"], "correct_index": 1 },
                  { "question": "Where was he born?", "options": ["Tehran", "Mashhad", "Shiraz"], "correct_index": 1 },
                  { "question": "What is his wife's job?", "options": ["English Teacher", "Nurse", "Artist"], "correct_index": 0 },
                  { "question": "Where was she born?", "options": ["America", "UK", "Iran"], "correct_index": 0 },
                  { "question": "What is her nationality?", "options": ["American", "Iranian", "British"], "correct_index": 1 },
                  { "question": "What are their hobbies?", "options": ["Cinema and Painting", "Sport and Reading", "Music and Travel"], "correct_index": 0 }
                ]
              }
            ]
          },
          {
            "unit_id": 4,
            "unit_title": "The Weekend (آخر هفته - āxar-e hafte)",
            "description": "Talk about past events, weekend activities, films, and food.",
            "content_sequence": [
              {
                "type": "dialogue",
                "id": "u4_d1",
                "title": "Dialogue 1: Wish you were there!",
                "context": "Simin (S) and Parviz (P) talk about last weekend.",
                "lines": [
                  { "speaker": "S", "farsi": "آخر هفته خوش گذشت؟", "transliteration": "āxar-e hafte xoŝ gozaŝt?", "english": "Did you have a good weekend?" },
                  { "speaker": "P", "farsi": "بله، جاتون خالی بود!", "transliteration": "bale, jātun xāli bud!", "english": "Yes, you should have been there (lit: your place was vacant)!" },
                  { "speaker": "S", "farsi": "خب، چه کار کردید؟ کجا رفتید؟", "transliteration": "xob, ce-kār kardid? kojā raftid?", "english": "So, what did you do? Where did you go?" },
                  { "speaker": "P", "farsi": "شب جمعه رفتیم سینما. یک فیلم ایرانی دیدیم.", "transliteration": "ŝab-e jom'e raftim sinemā. ye(k) film-e irāni didim.", "english": "Thursday night we went to the cinema. We saw an Iranian film." },
                  { "speaker": "S", "farsi": "خوب بود؟", "transliteration": "xub bud?", "english": "Was it good?" },
                  { "speaker": "P", "farsi": "کمدی بود. خیلی خندیدیم. شما چه کار کردید؟", "transliteration": "komedi bud. xeili xandidim. ŝomā ce-kār kardid?", "english": "It was a comedy. We laughed a lot. What did you do?" },
                  { "speaker": "S", "farsi": "پنجشنبه بعد از ظهر، مهمون داشتیم. جشن تولد پسرم بود.", "transliteration": "panj-ŝanbe ba'd-az-zohr, mehmun dāŝtim. jaŝn-e tavallode pesaram bud.", "english": "Thursday afternoon, we had guests. It was my son's birthday." },
                  { "speaker": "P", "farsi": "به به! تولدش مبارک!", "transliteration": "bah-bah! tavallodeŝ mobārak!", "english": "Wow! Happy birthday to him!" },
                  { "speaker": "S", "farsi": "ممنون.", "transliteration": "mamnun.", "english": "Thanks." },
                  { "speaker": "P", "farsi": "غذا چطور بود؟", "transliteration": "qazā cetour bud?", "english": "How was the food?" },
                  { "speaker": "S", "farsi": "عالی! دست پخت شوهرم بود!", "transliteration": "āli! dast-poxt-e ŝouharam bud!", "english": "Excellent! It was my husband's cooking!" },
                  { "speaker": "P", "farsi": "البته، بدون شک!", "transliteration": "albatte, bedun-e ŝak!", "english": "Of course, without a doubt!" }
                ]
              },
              {
                "type": "vocabulary",
                "title": "Vocabulary: Dialogue 1",
                "items": [
                  { "farsi": "آخر هفته", "transliteration": "āxar-e hafte", "english": "weekend" },
                  { "farsi": "خوش گذشتن", "transliteration": "xoŝ gozaŝtan", "english": "to pass pleasantly" },
                  { "farsi": "جا", "transliteration": "jā", "english": "place" },
                  { "farsi": "خالی", "transliteration": "xāli", "english": "vacant / empty" },
                  { "farsi": "رفتن", "transliteration": "raftan", "english": "to go" },
                  { "farsi": "دیدن", "transliteration": "didan", "english": "to see" },
                  { "farsi": "خندیدن", "transliteration": "xandidan", "english": "to laugh" },
                  { "farsi": "مهمون", "transliteration": "mehmun", "english": "guest" },
                  { "farsi": "جشن تولد", "transliteration": "jaŝn-e tavallod", "english": "birthday celebration" },
                  { "farsi": "غذا", "transliteration": "qazā", "english": "food" },
                  { "farsi": "دست پخت", "transliteration": "dast-poxt", "english": "cooking" },
                  { "farsi": "شوهر", "transliteration": "ŝouhar", "english": "husband" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Past Simple Tense",
                "content": "Formula: Past stem + Personal ending. (Stem of 'raftan' is 'raft'). All Persian verbs end with -an. To get past stem, omit -an.",
                "grammar_points": [
                  { "rule": "Conjugation", "examples": [
                      { "transliteration": "man raftam", "english": "I went" },
                      { "transliteration": "to rafti", "english": "You went" },
                      { "transliteration": "u raft", "english": "He went" },
                      { "transliteration": "mā raftim", "english": "We went" },
                      { "transliteration": "ŝomā raftid", "english": "You went" },
                      { "transliteration": "ānhā raftand", "english": "They went" }
                  ]},
                  { "rule": "Negative", "content": "Add na- (man naraftam). If verb starts with vowel, use nay- (nayumad)."}
                ],
                "notes": "No personal ending is used for the third-person singular (he/she/it)."
              },
              {
                "type": "teaching",
                "title": "Days of the Week",
                "content": "The week starts on Saturday in Iran.",
                "grammar_points": [
                  { "rule": "Days", "examples": [
                      { "transliteration": "ŝanbe", "english": "Saturday" },
                      { "transliteration": "yek-ŝanbe", "english": "Sunday" },
                      { "transliteration": "do-ŝanbe", "english": "Monday" },
                      { "transliteration": "se-ŝanbe", "english": "Tuesday" },
                      { "transliteration": "cahār-ŝanbe", "english": "Wednesday" },
                      { "transliteration": "panj-ŝanbe", "english": "Thursday" },
                      { "transliteration": "jom'e", "english": "Friday (Weekend)" }
                  ]}
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 1",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "prompt": "On Saturday, Ahmad came to London.", "correct_answer": "شنبه احمد به لندن آمد" },
                  { "prompt": "On Sunday, we went to the supermarket.", "correct_answer": "یکشنبه ما به سوپرمارکت رفتیم" },
                  { "prompt": "On Monday, we went to an Iranian restaurant.", "correct_answer": "دوشنبه ما به رستوران ایرانی رفتیم" },
                  { "prompt": "On Tuesday, I went to a birthday party.", "correct_answer": "سه شنبه من به جشن تولد رفتم" },
                  { "prompt": "On Wednesday, we went to a swimming pool.", "correct_answer": "چهارشنبه ما به استخر رفتیم" },
                  { "prompt": "On Thursday, Ahmad went to Iran.", "correct_answer": "پنجشنبه احمد به ایران رفت" },
                  { "prompt": "On Friday, my parents came to my home.", "correct_answer": "جمعه پدر و مادرم به خانه من آمدند" }
                ]
              },
              {
                "type": "teaching",
                "title": "Language Note: Reduction",
                "content": "In casual speech, prepositions are dropped. 'man be sinemā raftam' -> 'raftam sinemā'.",
                "grammar_points": [
                  { "rule": "Example", "examples": [{ "transliteration": "raftam sinemā", "english": "I went to the cinema" }] }
                ],
                "notes": "Three things happen: Subject omitted, preposition omitted, verb placed before place."
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 2",
                "instruction": "Repeat Exercise 1 using reduced forms (e.g. 'shanbe ahmad umad landan').",
                "questions": [
                  { "prompt": "On Saturday, Ahmad came to London.", "correct_answer": "شنبه احمد اومد لندن" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Word Order",
                "content": "Subject + Time + Manner + Place + Verb",
                "grammar_points": [
                  { "rule": "Example", "examples": [{ "transliteration": "man diruz bā tāksi be landan raftam", "english": "I went to London by taxi yesterday" }] }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 3: Word Order",
                "instruction": "Put these jumbled Persian words in the correct order (Subject + Time + Manner + Place + Verb). Write the full sentence in Persian.",
                "questions": [
                  { "prompt": "لندن / رفتیم / مترو / به / دیروز / ما / با", "correct_answer": "ما دیروز با مترو به لندن رفتیم" },
                  { "prompt": "کلاس / به / آمدید / امروز / شما / دیر", "correct_answer": "شما امروز دیر به کلاس آمدید" },
                  { "prompt": "هواپیما / ایران / آنها / سه شنبه / به / رفتند / روز / با", "correct_answer": "آنها روز سه شنبه با هواپیما به ایران رفتند" },
                  { "prompt": "با / رفتم / به / من / شنبه / خانمم / روز / سوپرمارکت", "correct_answer": "من روز شنبه با خانمم به سوپرمارکت رفتم" }
                ]
              },
              {
                "type": "teaching",
                "title": "Language Note: 'I saw a film'",
                "content": "To say 'I saw a film in London yesterday': Subject + Time + Place + Object + Verb",
                "grammar_points": [
                  { "rule": "Example", "examples": [{ "farsi": "من دیروز در لندن یک فیلم دیدم", "transliteration": "man diruz dar landan yek film didam", "english": "I saw a film in London yesterday" }]}
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 4",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "prompt": "I ate lunch in a restaurant yesterday.", "correct_answer": "من دیروز در رستوران ناهار خوردم" },
                  { "prompt": "I read a book in the library yesterday.", "correct_answer": "من دیروز در کتابخانه کتاب خواندم" },
                  { "prompt": "I saw a film in the cinema last night.", "correct_answer": "من دیشب در سینما فیلم دیدم" },
                  { "prompt": "I ate a sandwich at work this morning.", "correct_answer": "من امروز صبح در محل کار ساندویچ خوردم" },
                  { "prompt": "I cooked an Iranian dish at home today.", "correct_answer": "من امروز در خانه غذای ایرانی درست کردم" },
                  { "prompt": "What did you do at the weekend?", "correct_answer": "آخر هفته چه کار کردید؟" },
                  { "prompt": "Nothing! I slept all day!", "correct_answer": "هیچ! تمام روز خوابیدم" }
                ]
              },
              {
                "type": "dialogue",
                "id": "u4_d2",
                "title": "Dialogue 2: Nothing to write home about!",
                "context": "Cousins Saman (S) and Marjan (M) talk about their weekend.",
                "lines": [
                  { "speaker": "S", "farsi": "آخر هفته خوش گذشت؟", "transliteration": "āxar-e hafte xoŝ gozaŝt?", "english": "Did you have a good weekend?" },
                  { "speaker": "M", "farsi": "تعریفی نداشت!", "transliteration": "ta'rifi nadāŝt!", "english": "Nothing to write home about! (lit: It didn't have any compliment)" },
                  { "speaker": "S", "farsi": "چطور مگه؟", "transliteration": "cetour mage?", "english": "But why? (How come?)" },
                  { "speaker": "M", "farsi": "کار خاصی نکردم. تو خونه موندم و تلویزیون تماشا کردم. آخر هفته ی تو چطور بود؟", "transliteration": "kār-e xāssi nakardam. tu xune mundam o televizion tamāŝā kardam. āxar-e hafte-ye to cetour bud?", "english": "I didn't do anything special. I stayed at home and watched TV. How was your weekend?" },
                  { "speaker": "S", "farsi": "بد نبود. برای شام از سوپر مارکت یک ساندویچ و یک پیتزا خریدم.", "transliteration": "bad nabud. barāye ŝām az supermārket ye(k) sāndevic o ye(k) pitzā xaridam.", "english": "It wasn't bad. For dinner I bought a sandwich and a pizza from the supermarket." },
                  { "speaker": "S", "farsi": "من ساندویچو خوردم؛ دوستم پیتزا رو خورد. بعد تا صبح شطرنج بازی کردیم!", "transliteration": "man sāndevic-o xordam; dustam pitzā-ro xord. ba`d tā sobh ŝatranj bāzi kardim!", "english": "I ate the sandwich; my friend ate the pizza. Then we played chess until morning!" },
                  { "speaker": "M", "farsi": "بردی یا باختی؟", "transliteration": "bordi yā bāxti?", "english": "Did you win or lose?" },
                  { "speaker": "S", "farsi": "مساوی شدیم!", "transliteration": "mosāvi ŝodim!", "english": "We drew!" }
                ]
              },
              {
                "type": "vocabulary",
                "title": "Vocabulary: Dialogue 2",
                "items": [
                  { "farsi": "تعریف", "transliteration": "ta'rif", "english": "compliment" },
                  { "farsi": "خاص", "transliteration": "xāss", "english": "special" },
                  { "farsi": "تماشا کردن", "transliteration": "tamāŝā kardan", "english": "to watch" },
                  { "farsi": "ماندن", "transliteration": "māndan (mundan)", "english": "to stay" },
                  { "farsi": "خریدن", "transliteration": "xaridan", "english": "to buy" },
                  { "farsi": "خوردن", "transliteration": "xordan", "english": "to eat" },
                  { "farsi": "بازی کردن", "transliteration": "bāzi kardan", "english": "to play" },
                  { "farsi": "بردن", "transliteration": "bordan", "english": "to win" },
                  { "farsi": "باختن", "transliteration": "bāxtan", "english": "to lose" },
                  { "farsi": "مساوی", "transliteration": "mosāvi", "english": "equal / draw" }
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Compound Verbs",
                "content": "Combine a noun/adjective with a simple verb like 'kardan'.",
                "grammar_points": [
                  { "rule": "Examples", "examples": [
                      { "transliteration": "kār kardan", "english": "to work" },
                      { "transliteration": "telefon kardan", "english": "to telephone" },
                      { "transliteration": "bāzi kardan", "english": "to play" }
                  ]}
                ]
              },
              {
                "type": "teaching",
                "title": "Grammar: Direct Object Marker (rā)",
                "introduction": "The word rā plays an important role.",
                "content": "Golden Rules for 'rā': 1. Must be the object. 2. Must be direct. 3. Must be definite. 4. Must NOT be preceded by a preposition.",
                "grammar_points": [
                  { "rule": "Example", "examples": [
                      { "farsi": "ساندویچو خوردم", "transliteration": "sāndevic-o xordam", "english": "I ate the sandwich" }
                  ]}
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "comprehension",
                "title": "Exercise 5: Concept Check",
                "instruction": "Would these English sentences need 'ra' in Persian?",
                "questions": [
                  { "question": "I saw James.", "options": ["Yes", "No"], "correct_index": 0 },
                  { "question": "I bought him a drink.", "options": ["Yes", "No"], "correct_index": 1 },
                  { "question": "She ate the sandwich.", "options": ["Yes", "No"], "correct_index": 0 },
                  { "question": "I looked at her.", "options": ["Yes", "No"], "correct_index": 1 }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "fill_in_blank",
                "input_mode": "farsi",
                "title": "Exercise 6: Object Marker (rā)",
                "instruction": "Fill in the blank with 'را' (rā) if needed, or leave it empty. Write the full sentence in Persian.",
                "questions": [
                  { "prompt": "من امروز او ... دیدم", "correct_answer": "من امروز او را دیدم" },
                  { "prompt": "من آب ... زیاد خوردم", "correct_answer": "من آب زیاد خوردم" },
                  { "prompt": "من این آب ... نخوردم چون گرم بود", "correct_answer": "من این آب را نخوردم چون گرم بود" },
                  { "prompt": "احمد برای من بستنی و کیک ... خرید", "correct_answer": "احمد برای من بستنی و کیک خرید" },
                  { "prompt": "من کیک ... خوردم", "correct_answer": "من کیک را خوردم" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 7",
                "instruction": "Translate into Persian.",
                "questions": [
                  { "prompt": "I saw him/her today.", "correct_answer": "من امروز او را دیدم" },
                  { "prompt": "I drank a lot of water.", "correct_answer": "من آب زیاد خوردم" },
                  { "prompt": "I didn't drink this water because it was warm.", "correct_answer": "من این آب را نخوردم چون گرم بود" },
                  { "prompt": "Ahmad bought ice cream and cake for me.", "correct_answer": "احمد برای من بستنی و کیک خرید" },
                  { "prompt": "I ate the cake.", "correct_answer": "من کیک را خوردم" }
                ]
              },
              {
                "type": "exercise",
                "exercise_type": "translation_input",
                "input_mode": "farsi",
                "title": "Exercise 8",
                "instruction": "Can you say these in Persian?",
                "questions": [
                  { "prompt": "Did you have a good holiday?", "correct_answer": "تعطیلات خوش گذشت؟" },
                  { "prompt": "Yes, wish you were there!", "correct_answer": "بله، جاتون خالی بود" },
                  { "prompt": "Nothing to write home about!", "correct_answer": "تعریفی نداشت" },
                  { "prompt": "We didn't do anything special.", "correct_answer": "کار خاصی نکردیم" },
                  { "prompt": "We stayed at home and watched the rain!", "correct_answer": "تو خونه موندیم و بارون تماشا کردیم" },
                  { "prompt": "What was your weekend like?", "correct_answer": "آخر هفته ات چطور بود؟" },
                  { "prompt": "I worked on Saturday.", "correct_answer": "شنبه کار کردم" },
                  { "prompt": "On Sunday I went to my friend's home.", "correct_answer": "یکشنبه به منزل دوستم رفتم" },
                  { "prompt": "We ate some Iranian food.", "correct_answer": "غذای ایرانی خوردیم" },
                  { "prompt": "I cooked it!", "correct_answer": "من درست کردم" },
                  { "prompt": "We watched an Iranian film.", "correct_answer": "یک فیلم ایرانی دیدیم" },
                  { "prompt": "We played backgammon.", "correct_answer": "تخته نرد بازی کردیم" }
                ]
              },
              {
                "type": "comprehension",
                "title": "Comprehension: Simin's Story",
                "context": "Simin talks about Mahnaz's party.",
                "questions": [
                  { "question": "Where did Simin go?", "options": ["Cinema", "Birthday party", "Park"], "correct_index": 1 },
                  { "question": "How many guests were there?", "options": ["Fifty", "Twenty", "Ten"], "correct_index": 0 },
                  { "question": "How was the food?", "options": ["Bad", "Excellent", "Cold"], "correct_index": 1 },
                  { "question": "Who cooked the food?", "options": ["Mahnaz", "Mahnaz's mother", "Simin"], "correct_index": 1 },
                  { "question": "What did they do after dinner?", "options": ["Watched a comedy film", "Slept", "Went home"], "correct_index": 0 }
                ]
              }
            ]
          } 
        ]
    };

    // ==========================================
    // APP LOGIC
    // ==========================================

    const contentArea = document.getElementById('contentArea');
    const pageTitle = document.getElementById('pageTitle');
    const backBtn = document.getElementById('backBtn');

    function init() {
        if (!courseData || !courseData.units || courseData.units.length === 0) {
            contentArea.innerHTML = '<div style="padding:40px;text-align:center;color:#888;"><h3>App is Ready</h3><p>Open the HTML file in a text editor and paste the JSON data into the <code>units</code> array.</p></div>';
            return;
        }
        renderHome();
    }

    // --- RENDER HOME (Unit List) ---
    function renderHome() {
        backBtn.classList.add('hidden');
        pageTitle.innerText = courseData.course_title;
        contentArea.innerHTML = '';

        const list = document.createElement('div');
        
        courseData.units.forEach((unit) => {
            const el = document.createElement('div');
            el.className = 'unit-card';
            el.onclick = () => renderUnit(unit);
            el.innerHTML = `
                <div class="unit-meta">Unit ${unit.unit_id}</div>
                <div class="unit-title">${unit.unit_title}</div>
                <div class="unit-desc">${unit.description}</div>
            `;
            list.appendChild(el);
        });
        
        contentArea.appendChild(list);
    }

    // --- RENDER UNIT ---
    function renderUnit(unit) {
        backBtn.classList.remove('hidden');
        pageTitle.innerText = `Unit ${unit.unit_id}`;
        contentArea.innerHTML = '';
        contentArea.scrollTop = 0;

        if (!unit.content_sequence) return;

        unit.content_sequence.forEach((section, idx) => {
            const secId = `s-${idx}`;
            
            // Header
            const header = document.createElement('div');
            header.className = 'section-header';
            header.innerText = section.title || section.type;
            contentArea.appendChild(header);

            const card = document.createElement('div');
            card.className = 'card';

            // 1. DIALOGUE
            if (section.type === 'dialogue') {
                if (section.context) {
                    const ctx = document.createElement('div');
                    ctx.className = 'context-box';
                    ctx.innerText = section.context;
                    card.appendChild(ctx);
                }
                section.lines.forEach(line => {
                    const row = document.createElement('div');
                    row.className = 'dialogue-row';
                    row.innerHTML = `
                        <div class="speaker">${line.speaker}</div>
                        <div class="farsi">${line.farsi}</div>
                        <div class="translit">${line.transliteration}</div>
                        <div class="eng">${line.english}</div>
                    `;
                    card.appendChild(row);
                });
            }

            // 2. VOCABULARY
            else if (section.type === 'vocabulary') {
                section.items.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'vocab-row';
                    row.innerHTML = `
                        <div class="vocab-left">
                            <div class="vocab-word">${item.transliteration}</div>
                            <div class="vocab-def">${item.english}</div>
                        </div>
                        <div class="vocab-farsi">${item.farsi}</div>
                    `;
                    card.appendChild(row);
                });
            }

            // 3. TEACHING (Grammar/Culture)
            else if (section.type === 'teaching') {
                const box = document.createElement('div');
                box.className = 'teaching-block';

                if (section.introduction) box.innerHTML += `<div class="teaching-text">${section.introduction}</div>`;
                if (section.content) box.innerHTML += `<div class="teaching-text">${section.content}</div>`;

                if (section.grammar_points) {
                    section.grammar_points.forEach(pt => {
                        const ptDiv = document.createElement('div');
                        ptDiv.className = 'grammar-point';
                        if (pt.rule) ptDiv.innerHTML += `<span class="gp-title">${pt.rule}</span>`;
                        if (pt.content) ptDiv.innerHTML += `<div class="teaching-text" style="font-size:14px;">${pt.content}</div>`;

                        // Examples
                        if (pt.examples) {
                            pt.examples.forEach(ex => {
                                let html = `<div class="example-box">`;
                                if (ex.type === 'Statement' || ex.type === 'Question') {
                                    html += `<div style="font-size:11px;font-weight:bold;color:#888;margin-bottom:2px;">${ex.type}</div>`;
                                }
                                if (ex.farsi) html += `<div class="farsi" style="font-size:17px;">${ex.farsi}</div>`;
                                html += `<div class="example-meta">
                                    <span style="font-weight:600;color:#333;">${ex.transliteration || ''}</span> 
                                    ${ex.english ? ` - ${ex.english}` : ''}
                                </div></div>`;
                                ptDiv.innerHTML += html;
                            });
                        }

                        // Tables
                        if (pt.table) {
                            let tbl = `<table class="g-table">`;
                            pt.table.forEach(r => {
                                tbl += `<tr><td class="farsi">${r.farsi}</td><td><b>${r.translit}</b><br>${r.eng}</td></tr>`;
                            });
                            tbl += `</table>`;
                            ptDiv.innerHTML += tbl;
                        }
                        box.appendChild(ptDiv);
                    });
                }

                // Important Notes
                if (section.notes) {
                    const note = document.createElement('div');
                    note.className = 'note-box';
                    note.innerHTML = `<strong>Note:</strong> ${section.notes}`;
                    box.appendChild(note);
                }
                
                card.appendChild(box);
            }

            // 4. EXERCISES & COMPREHENSION
            else if (section.type === 'exercise' || section.type === 'comprehension') {
                const box = document.createElement('div');
                box.className = 'exercise-container';

                // Context for Comprehension
                if (section.context) box.innerHTML += `<p style="margin-top:0; font-weight:600; border-bottom:1px solid #eee; padding-bottom:8px;">Context: ${section.context}</p>`;
                
                // Dialogue display inside Exercise (e.g. Comprehension)
                if (section.dialogue) {
                    const dBox = document.createElement('div');
                    dBox.style.background = "#f9f9f9"; 
                    dBox.style.padding = "10px";
                    dBox.style.marginBottom = "20px";
                    dBox.style.borderRadius = "8px";
                    section.dialogue.forEach(l => {
                        dBox.innerHTML += `<div style="margin-bottom:8px; border-bottom:1px solid #e0e0e0; padding-bottom:4px;">
                            <span style="color:var(--primary); font-weight:bold; font-size:11px;">${l.speaker}</span>
                            <div style="font-size:16px; direction:rtl; font-family:Tahoma;">${l.farsi}</div>
                            <div style="font-size:13px; color:#555;">${l.english}</div>
                        </div>`;
                    });
                    box.appendChild(dBox);
                }

                if (section.instruction) box.innerHTML += `<div class="ex-instruction">${section.instruction}</div>`;

                // --- MATCHING ---
                if (section.exercise_type === 'matching' && section.pairs) {
                    section.pairs.forEach((pair, pIdx) => {
                        const row = document.createElement('div');
                        row.className = 'matching-row';
                        
                        // Dropdown options
                        const options = section.pairs.map(p => `<option value="${p.match}">${p.match}</option>`).join('');
                        
                        row.innerHTML = `
                            <span class="q-prompt" style="font-size:14px; margin:0;">${pair.prompt}</span>
                            <select id="${secId}-m-${pIdx}" class="match-select" onchange="checkMatch(this, '${pair.match}', '${secId}-fb-${pIdx}')">
                                <option value="">Select...</option>
                                ${options}
                            </select>
                            <span id="${secId}-fb-${pIdx}" style="width:24px; text-align:center;"></span>
                        `;
                        box.appendChild(row);
                    });
                } 
                // --- QUESTIONS (Radio or Input) ---
                else if (section.questions) {
                    section.questions.forEach((q, qIdx) => {
                        const qId = `${secId}-q-${qIdx}`;
                        const qDiv = document.createElement('div');
                        qDiv.className = 'question-item';

                        // Check input mode
                        const isFarsi = section.input_mode === 'farsi';

                        // A. Multiple Choice
                        if (q.options) {
                            qDiv.innerHTML = `<span class="q-prompt">${qIdx+1}. ${q.prompt || q.question}</span>`;
                            q.options.forEach((opt, oIdx) => {
                                qDiv.innerHTML += `
                                <div class="radio-label" onclick="selectRadio(this)">
                                    <input type="radio" name="${qId}" value="${oIdx}"> ${opt}
                                </div>`;
                            });
                            qDiv.innerHTML += `
                                <button class="btn-check" style="margin-top:8px;" onclick="checkRadio('${qId}', ${q.correct_index}, '${qId}-fb')">Check</button>
                                <div id="${qId}-fb" class="feedback"></div>`;
                        } 
                        // B. Text Input (Translation / Fill blank / Substitution)
                        else {
                            const inputClass = isFarsi ? 'farsi-input' : '';
                            const placeH = isFarsi ? 'پاسخ...' : 'Type answer...';
                            const promptClass = (isFarsi && /[\u0600-\u06FF]/.test(q.prompt)) ? 'q-prompt rtl' : 'q-prompt';

                            qDiv.innerHTML = `
                                <span class="${promptClass}">${qIdx+1}. ${q.prompt}</span>
                                <div class="input-wrapper">
                                    <input type="text" id="${qId}-in" class="${inputClass}" placeholder="${placeH}">
                                    <button class="btn-check" onclick="checkText('${qId}-in', '${escapeStr(q.correct_answer)}', '${qId}-fb', ${isFarsi})">Check</button>
                                </div>
                                <div style="display:flex; align-items:center; margin-top:5px;">
                                    <div id="${qId}-fb" class="feedback"></div>
                                    <button class="btn-show" onclick="showAns('${qId}-fb', '${escapeStr(q.correct_answer)}', ${isFarsi})">Show Answer</button>
                                </div>
                            `;
                        }
                        box.appendChild(qDiv);
                    });
                }
                
                card.appendChild(box);
            }

            contentArea.appendChild(card);
        });
    }

    // ==========================================
    // CHECKING LOGIC
    // ==========================================

    function escapeStr(str) {
        if (!str) return '';
        return str.replace(/'/g, "\\'");
    }

    // Normalizes Farsi text to ignore minor differences (like ZWNJ, kashida, different Y/K chars)
    function normalizeFarsi(str) {
        if (!str) return '';
        return str.trim()
            .replace(/[ي]/g, 'ی')
            .replace(/[ك]/g, 'ک')
            .replace(/[ ]/g, '') // remove spaces for lenient checking
            .replace(/\u200c/g, '') // remove ZWNJ
            .replace(/[.,!?;:()]/g, ''); // remove punctuation
    }

    function cleanText(str) {
        if (!str) return '';
        return str.toLowerCase().replace(/[.,!?;:()]/g, '').replace(/\s+/g, '').trim();
    }

    window.checkText = function(inputId, correct, feedbackId, isFarsi) {
        const val = document.getElementById(inputId).value;
        const feedback = document.getElementById(feedbackId);
        let match = false;
        
        if (isFarsi) {
            match = normalizeFarsi(val) === normalizeFarsi(correct);
        } else {
            match = cleanText(val) === cleanText(correct);
        }

        if (match) {
            feedback.innerHTML = "Correct! ✅";
            feedback.className = "feedback correct";
        } else {
            feedback.innerHTML = "Try again.";
            feedback.className = "feedback wrong";
        }
    };

    window.showAns = function(feedbackId, correct, isFarsi) {
        const feedback = document.getElementById(feedbackId);
        feedback.innerHTML = correct;
        feedback.className = isFarsi ? "feedback info rtl" : "feedback info";
    };

    window.checkMatch = function(select, correct, feedbackId) {
        const feedback = document.getElementById(feedbackId);
        if (select.value === correct) {
            feedback.innerHTML = "✅";
            select.style.borderColor = "var(--success)";
        } else {
            feedback.innerHTML = "❌";
            select.style.borderColor = "var(--error)";
        }
    };

    window.selectRadio = function(div) {
        // Deselect siblings
        const parent = div.parentNode;
        const siblings = parent.querySelectorAll('.radio-label');
        siblings.forEach(el => el.classList.remove('selected'));
        // Select clicked
        div.classList.add('selected');
        div.querySelector('input').checked = true;
    };

    window.checkRadio = function(name, correctIdx, feedbackId) {
        const radios = document.getElementsByName(name);
        const feedback = document.getElementById(feedbackId);
        let selected = -1;
        
        for(let i=0; i<radios.length; i++) {
            if(radios[i].checked) selected = parseInt(radios[i].value);
        }

        if (selected === -1) {
            feedback.innerText = "Please select an answer.";
            feedback.className = "feedback";
        } else if (selected === correctIdx) {
            feedback.innerText = "Correct! ✅";
            feedback.className = "feedback correct";
        } else {
            feedback.innerText = "Incorrect.";
            feedback.className = "feedback wrong";
        }
    };

    // Initialize
    init();
</script>
</body>
</html>